# Clarity - Project Specification

> A personal operating system for intentional living

## Overview

Clarity is a privacy-first, AI-powered personal operating system designed to help users live more intentionally through structured reflection and goal tracking. Unlike gamified productivity tools, Clarity positions itself as a calm, intelligent companion—therapist-adjacent in tone, emphasizing reflection over motivation.

**Marketing URL:** https://www.obtainclarity.com/

**Tagline:** "Built to help you live intentionally, Clarity is your personal operating system"

**Core Philosophy:**
- "No cheerleading, no fluff" — explicitly anti-toxic-positivity
- "Calm, intelligent companion"
- "Honest questions that make me think"
- Focus on signal vs. noise

**Target Audience:** Knowledge workers and entrepreneurs (startup founders, engineering leads, product designers)

**Success Metric:** Daily personal use that genuinely helps

---

## Core Features

### Today
- **Inbox (Captures)** — Quick capture of thoughts, tasks, ideas with New/Done tabs
- **Daily Check-In** — 5-minute conversational ritual tracking energy, wins, friction, and setting the day's single priority

### Plan
- **North Star** — Living document (multi-paragraph personal manifesto) defined via guided conversation
- **Goals & Vision** — Tracking across six life domains with AI-derived progress
- **Thinking Frameworks** — AI-guided conversational exercises with time estimates and frequency recommendations

### Reflect
- **Reviews** — Weekly reflection covering signal vs. noise, goal progress, pattern recognition, and course correction
- **Self-Interviews** — TBD (deferred from MVP)
- **Memory & Insights** — AI-maintained memory that remembers patterns, strengths, and blind spots

---

## Life Domains

The system tracks progress across six core life domains:

1. **Work/Career** — Role, current state, targets, what's going well, energy drains
2. **Relationships** — Personal connections and social health
3. **Health** — Physical and mental wellbeing
4. **Meaning/Fun** — Purpose, hobbies, enjoyment
5. **Finances** — Financial targets and tracking (with specific numbers)
6. **Family** — Family relationships and responsibilities

**Additional Memory Sections:**
- Current Season (e.g., Q1 2026)
- Operating Rhythm
- People I'm Tracking (AI auto-extracted)
- Cross-Domain Tensions
- Rules I Trust
- AI Instructions (pre-filled with sensible defaults, user-customizable)
- Now/Next/Later prioritization

---

## Thinking Frameworks

AI-guided conversational exercises sourced from established methodologies:

| Framework | Source | Time | Frequency |
|-----------|--------|------|-----------|
| Annual Review | Various | 60-90 min | Yearly |
| Vivid Vision | Dr. Anthony Gustin | 45-60 min | Yearly |
| Ideal Lifestyle Costing | Tim Ferriss | 30-45 min | Yearly |
| Life Map | Tony Robbins | 60 min | As needed |
| Regret Minimization | Jeff Bezos | 15-20 min | As needed |
| Leverage vs Effort | Various | 20-30 min | Monthly |
| CEO Energy Management | Loehr & Schwartz | 30 min | Weekly |
| Personal Board of Directors | Alex Lieberman | 30 min | Quarterly |

**Interaction Model:** AI asks questions one at a time, follows up based on answers, guides user through the framework conversationally.

---

## Technical Architecture

### Tech Stack

| Layer | Technology |
|-------|------------|
| Framework | TanStack Start |
| Language | TypeScript |
| Styling | Tailwind CSS |
| UI Components | shadcn/ui |
| Auth & Analytics | Supabase |
| Local Database | Dexie (IndexedDB) |
| AI Services | Vercel AI Gateway (model-agnostic) |
| Cloud Storage | Google Drive |
| Mobile | Capacitor (iOS wrapper) |
| Hosting | Vercel |
| Payments | Stripe (web checkout) |

### Project Structure

```
/src           # TanStack Start app
/ios           # Generated by `npx cap add ios`
/android       # Later if needed
capacitor.config.ts
```

Or monorepo:

```
/apps
  /web         # TanStack Start app
  /ios         # Capacitor iOS project
/packages
  /ui          # Shared shadcn components
  /core        # Business logic, Dexie, sync
```

---

## Data Architecture

### Privacy Model

**Core Principle:** Users own their data. The app admin never sees personal information.

| Data Type | Storage Location |
|-----------|-----------------|
| Auth, subscription, analytics | Supabase |
| Captures, checkins, chats, memory, north star, frameworks | User's Google Drive |

### Google Drive File Structure

**Hybrid approach:**

```
/Clarity
  /memory.md                           # Single file, frequently synced
  /checkins
    /2026-01-10.json                   # One per day
    /2026-01-11.json
  /captures
    /2026-01-10.json                   # Daily file with all captures
    /2026-01-11.json
  /chats
    /2026-01-10-abc123.json            # Per conversation with date prefix
    /2026-01-10-def456.json
  /frameworks
    /annual-review-2026.json           # Per framework session
```

### Data Flow

1. User creates capture/checkin/etc
2. Write to Dexie (instant, works offline for captures)
3. Background sync to Google Drive
4. Dexie serves as source of truth for UI
5. Google Drive is backup/portability

### Dexie Schema

Tables:
- `captures`
- `checkins`
- `chats`
- `memory`
- `northstar`
- `frameworks`
- `syncQueue` (pending uploads)

### Sync Strategy

**Event-driven sync at meaningful moments:**

| Event | What Syncs |
|-------|------------|
| Capture saved | Capture file + memory update |
| Capture marked done | Append to daily digest, archive |
| Checkin completed | Checkin file + memory update |
| Chat message sent/received | Chat file + memory update |
| North star updated | North star file + memory update |
| Framework interaction | Framework file + memory update |

**Conflict Resolution:** Last-write-wins

**Sync Failure Handling:** Prompt re-auth immediately when Google Drive auth expires or is revoked.

**New Device Flow:**
1. Auth with Supabase
2. Connect to Google Drive
3. Pull files down and hydrate Dexie
4. Ready to use

### Offline Mode

**Capture only:** Users can add captures offline. Chat and AI features require connection. Captures queue locally and sync when back online.

---

## AI Integration

### Model Strategy

**Model-agnostic design:** Abstract behind Vercel AI Gateway, swap models freely based on cost/quality.

| Feature | Model Class | Rationale |
|---------|-------------|-----------|
| Chat | Fast/cheap (e.g., GPT-4o-mini, Claude Haiku) | High volume, streaming |
| Memory generation | Quality (e.g., GPT-4o, Claude Sonnet) | Lower volume, higher stakes |

### AI Integration Points

| Feature | AI Usage |
|---------|----------|
| Chat | Streaming conversation with full memory context |
| Memory generation | Summarize/extract from captures, checkins, chats |
| Capture processing | Extract themes, tags, action items |
| Checkin prompts | Personalized questions based on context |
| Framework guidance | AI-guided conversational exercises |
| Memory compression | Periodic auto-summarization to keep memory small |
| People extraction | Auto-detect significant people from conversations |
| Smart reminders | Decide when to nudge based on patterns |

### Vercel AI Gateway Setup

```typescript
import { createOpenAI } from '@ai-sdk/openai'

const gateway = createOpenAI({
  baseURL: 'https://gateway.ai.vercel.com/v1',
  apiKey: process.env.AI_GATEWAY_KEY,
})

// Model-agnostic: swap these based on cost/performance
const models = {
  chat: gateway('openai/gpt-4o-mini'),
  memory: gateway('openai/gpt-4o'),
}
```

### Continuous Learning

**Every interaction extracts learnings immediately** (accept the latency/cost for fresh memory):

```typescript
async function handleAnyInteraction(input: {
  type: 'capture' | 'checkin' | 'chat' | 'northstar' | 'framework'
  content: string
  currentMemory: Memory
}) {
  // 1. Generate response (if needed)
  const response = await generateResponse(input)

  // 2. Always extract learnings and update memory
  const memoryDelta = await extractLearnings(input, response)

  // 3. Apply updates (append as evolution, not overwrite)
  if (memoryDelta.hasChanges) {
    await applyMemoryUpdate(memoryDelta)
    await syncToCloud('memory', updatedMemory)
  }

  return response
}
```

**Learning Extraction Prompt:**
> Given this [capture/chat/checkin], what did we learn about the user that should update their memory?
> Consider: new facts, changed circumstances, patterns confirmed, progress on goals, new tensions, corrections to existing beliefs.
> Return only meaningful updates - not everything is worth remembering.
> When beliefs change, append as evolution: "Previously loved job, now experiencing burnout (Jan 2026)"

### Memory Conflict Resolution

**Append as evolution:** When new information contradicts existing memory, don't overwrite. Instead, track the evolution:

```markdown
**Current State:** Burned out, questioning role (as of Jan 2026)
*Previously: Excited about new role (Sept 2025)*
```

### Memory Compression

**AI auto-compresses:** Periodically, the AI rewrites memory to be more concise, merging redundant entries while preserving meaningful evolution. Old versions stored in Drive for history.

### People Auto-Extraction

**AI judgment call:** When a person is mentioned with meaningful context (relationship, pattern, recurring reference), AI adds them to "People I'm Tracking" section. No explicit threshold — AI decides based on significance.

### Analytics to Track (Supabase)

| Metric | Purpose |
|--------|---------|
| Signups, logins | Auth tracking |
| Subscription status | Billing |
| Feature usage counts | Adoption patterns |
| Session length | Engagement |
| Check-in completion rate | Habit formation |
| Interactions per user/day | Volume baseline |
| Memory updates per interaction | Learning frequency |
| Tokens per extraction call | Cost tracking |

---

## AI System Prompt

The core system prompt for chat interactions:

```
You are Clarity, a calm and intelligent personal companion. You help the user live more intentionally through honest reflection, not motivation or cheerleading.

## Tone
- Warm but direct. Never effusive or sycophantic.
- Ask questions that make them think, not questions with obvious answers.
- Acknowledge difficulty without toxic positivity. "That sounds hard" not "You've got this!"
- Be genuinely curious about their experience, not performatively supportive.
- Silence and space are okay. Don't fill every gap.

## What you do
- Help them see patterns they might miss
- Surface tensions between what they say and what they do
- Remember what matters to them and reference it naturally
- Challenge gently when you notice avoidance or rationalization
- Celebrate wins without making it weird

## What you don't do
- Cheerleading, motivational speeches, or empty encouragement
- Advice-giving unless explicitly asked (prefer questions)
- Rushing through hard emotions to get to solutions
- Pretending everything is fine when it clearly isn't
- Generic productivity tips

## When they give terse answers
If they respond with "fine", "nothing", "idk" — probe gently once:
"Fine is okay. Anything specific on your mind?"
Then accept their answer and move on. Respect their energy.

## AI Instructions from Memory
The user's memory may contain an "AI Instructions" section with personalized guidance. Follow those instructions, but only surface patterns reactively (when you see them happening), not preemptively.

## Context
You have access to the user's memory document which contains their life domains, current priorities, people they're tracking, rules they trust, and patterns to watch. Reference this naturally in conversation.

Current memory:
{memory}

Previous messages in this session:
{chat_history}
```

---

## Memory Structure

The memory is a structured markdown document, kept small enough to fit in context:

```markdown
# Personal Operating Memory

*Last updated: January 2026*

---

## Current Season: Q1 2026

**Theme:** [User's theme for this quarter]

**Focus Areas:**
- [Key focus 1]
- [Key focus 2]
- [Key focus 3]

---

## Operating Rhythm

**Daily Check-in:** [Time and pattern]
**Weekly Review:** [Day and time]
**Quarterly Review:** [Timing]
**Annual Review:** [Timing]

---

## Life Domains

### Work
- **Role:** [Current role and company]
- **Current State:** [Where they are]
- **Target:** [Where they're going]
- **Going Well:** [List of wins]
- **Energy Drains:** [What's hard]

### Family
[Similar structure]

### Finances
[With specific numbers]

### Relationships
[Similar structure]

### Health
[Similar structure]

### Meaning/Fun
[Similar structure]

---

## Cross-Domain Tensions

[Conflicts between priorities, time allocation challenges]

---

## People I'm Tracking

### [Person Name]
- [Relationship]
- [Key context]
- [Patterns or notes]

---

## Rules I Trust

1. [Personal principle]
2. [Personal principle]
3. [Personal principle]

---

## AI Instructions

- [Tone preferences]
- [What to surface]
- [Patterns to watch]
- [Topics to ask about]

---

## Now / Next / Later

### Now
- [Current priority 1]
- [Current priority 2]

### Next
- [Upcoming priority]

### Later
- [Future consideration]
```

**Default AI Instructions (pre-filled for new users):**
```markdown
## AI Instructions

- Use coaching tone - supportive but challenging
- Ask about neglected domains periodically
- Look for wins - help me recognize progress
- Be direct about time allocation tradeoffs
- If I'm avoiding something, gently call it out
```

**Memory Versioning:** Monthly snapshots stored in Drive (`memory-2026-01.md`, `memory-2026-02.md`) for evolution tracking.

---

## Chat System

### Session Boundaries

**Auto-session by gap:** 24+ hour gap between messages = new session. Each session stored as a separate file in Drive.

Benefits:
- Zero friction — user just talks
- Natural conversation units
- Browsable history
- Clean file structure

### Chat Persistence

**Full transcript forever:** All messages stored in Google Drive. User can manually delete conversations if desired.

### Context Injection

**Keep memory small enough to fit:** AI auto-compresses memory to stay within context limits. Full memory injected into every chat.

---

## Check-In System

### Daily Check-In

**Conversational format:** AI asks questions one at a time, follows up based on answers.

**Core questions:**
1. Energy level (how are you feeling?)
2. Wins (what went well yesterday?)
3. Friction (what was hard?)
4. Single priority (what's the ONE thing for today?)

**Single priority philosophy:** Force the choice. Even when multiple things feel urgent, the app asks for one priority. This is part of the intentionality philosophy.

**Terse response handling:** If user gives terse answers ("fine", "nothing"), probe gently once, then accept and move on.

### Check-In Timing

**Default screen:** Today view (Inbox + Check-in) when opening app.

### Skipped Check-Ins

**Gentle acknowledgment:** When user returns after a gap:
> "Welcome back. No need to catch up — let's start fresh today."

No guilt, no pressure to explain the gap.

---

## Capture System

### Capture Flow

1. User writes capture (thought, task, idea)
2. Saved to Dexie immediately (works offline)
3. AI extracts learnings to memory
4. Synced to daily captures file in Drive

### Done Captures

**Daily digest then archive:**
1. When capture marked "done", immediately append to today's running digest
2. Digest stored in daily file
3. Original capture archived (not deleted)

### Capture View

- **New tab:** Active captures
- **Done tab:** Completed captures (grayed/archived)

---

## Notifications & Nudges

### Smart Reminders

**AI decides when to nudge** based on multiple signals:
- Time since last interaction (3+ days = nudge)
- Incomplete patterns (missed check-in, pending captures)
- Goal-based (you said you'd exercise this week...)

### Nudge Delivery

**In-app banners:** Subtle banners in Today view, not push notifications for MVP.

Example nudges:
- "Tip: Tell me about your work role"
- "You mentioned exercising this week — how's it going?"
- "It's been a few days. Quick check-in?"

### Onboarding Nudges

**Grow organically with prompts:** New users start with empty memory. In-app banners guide them toward capturing more info over time, not a lengthy onboarding flow.

---

## Mobile Strategy (Capacitor)

### Why Capacitor
- Keeps TanStack Start + Tailwind + shadcn codebase intact
- Native shell with access to native APIs
- Real App Store presence option
- Native push notifications, background sync, better storage

### Setup

```bash
npm install @capacitor/core @capacitor/cli
npx cap init Clarity com.clarity.app
npx cap add ios
npm run build
npx cap sync
npx cap open ios
```

### Now vs Later

| Now | Later |
|-----|-------|
| Capacitor in project from start | Android |
| Safe area handling (notches) | Push notifications |
| Touch-friendly UI (44px tap targets) | Background sync |
| Secure token storage | Apple Sign In |
| Google Drive OAuth native flow | App Store submission |

### Google Drive OAuth on iOS

Web OAuth redirects don't work cleanly in Capacitor. Use:

```typescript
import { Browser } from '@capacitor/browser'

// Open OAuth in native browser
await Browser.open({ url: googleAuthUrl })

// Handle redirect back via deep link
App.addListener('appUrlOpen', (data) => {
  // Extract tokens from redirect URL
})
```

### Technical Spikes (Early)
- Google Drive OAuth in Capacitor
- Vercel AI Gateway streaming in Capacitor webview
- Dexie persistence across app restarts on iOS

---

## Design System

### Color System

**Dark Mode (Default)**

| Token | Value | Usage |
|-------|-------|-------|
| `background` | `hsl(0 0% 4%)` | Page background |
| `card` | `hsl(0 0% 8%)` | Card surfaces, input fields |
| `card-hover` | `hsl(0 0% 10%)` | Hover states |
| `border` | `hsl(0 0% 15%)` | Subtle borders |
| `muted-foreground` | `hsl(0 0% 45%)` | Secondary text |
| `foreground` | `hsl(0 0% 95%)` | Primary text |
| `accent` | `hsl(35 90% 55%)` | Amber/gold highlights |

**Light Mode:** Available via toggle, dark is default. Clean white background with subtle gray borders (shadcn defaults with minor adjustments).

### CSS Variables

```css
:root {
  --background: 0 0% 100%;
  --foreground: 0 0% 4%;
  --card: 0 0% 98%;
  --card-foreground: 0 0% 4%;
  --muted: 0 0% 96%;
  --muted-foreground: 0 0% 45%;
  --accent: 35 90% 55%;
  --accent-foreground: 0 0% 4%;
  --border: 0 0% 90%;
  --radius: 0.5rem;
}

.dark {
  --background: 0 0% 4%;
  --foreground: 0 0% 95%;
  --card: 0 0% 8%;
  --card-foreground: 0 0% 95%;
  --muted: 0 0% 12%;
  --muted-foreground: 0 0% 50%;
  --border: 0 0% 15%;
}
```

### Typography

| Element | Style |
|---------|-------|
| Page titles | ~24-28px, font-medium |
| Section headers | ~14px, font-medium, uppercase, tracking-wide, muted |
| Card titles | ~16px, font-medium |
| Body text | ~14px, font-normal, muted-foreground |
| Small labels | ~12px, uppercase, tracking-wider |

**Font:** Inter or similar geometric sans-serif

### Layout

- Container max-width: ~720px
- Generous vertical padding (py-8 to py-12)
- Card padding: p-4 to p-6
- Border radius: rounded-lg (8px)
- 2-column grid for framework cards

### shadcn Component Mapping

| Pattern | Component |
|---------|-----------|
| Framework cards | Card |
| Life domains | Accordion or Collapsible |
| Navigation | Tabs (for New/Done) |
| Inputs | Input with custom styling |
| Buttons | Button (ghost, default, outline) |
| Chat messages | Custom component |
| Modals | Dialog |
| Forms | Form + Input + Label |
| Status pills | Toggle Group |

### Error States

**Generic retry:** When AI fails (rate limit, network error, timeout), show:
> "Something went wrong. Tap to retry."

Simple and clear, no technical details.

---

## Business Model

### Pricing

**Paid only:** Subscription required, no free tier.

- **Monthly:** $10/month
- **Annual:** $99/year (save ~17%)

### Trial

**7-day free trial, card-free:** Users can try the full product for 7 days without entering payment info. After trial, prompted to subscribe.

### Payment Flow

**Stripe web checkout:** Even for iOS users, checkout happens on web to avoid Apple's 30% cut.

1. User taps "Subscribe" in app
2. Opens Stripe checkout in browser
3. Completes payment
4. Manual return to app (show "Return to Clarity" button)
5. App polls/checks subscription status

### Account Deletion

**Full delete:** When user requests deletion:
1. Delete all Supabase data (auth, subscription, analytics)
2. User keeps their Google Drive files (they own that data)

No grace period, no forced export (they already have their data in Drive).

---

## Data Export

**One-click ZIP:** Users can download all their data as a single archive containing:
- memory.md
- All captures (JSON)
- All check-ins (JSON)
- All chats (JSON)
- All framework sessions (JSON)

**No sharing:** Clarity is completely private. Users can copy/paste to share with therapists/coaches, but no built-in sharing mechanism.

---

## MVP Scope

### Include

- Auth (Supabase)
- Captures with New/Done
- Conversational check-ins
- Chat with memory context
- Memory (single markdown doc with auto-compression)
- Google Drive sync
- Dexie for offline captures
- iOS via Capacitor
- Stripe subscription
- One-click data export

### Defer

- Multiple cloud providers (Dropbox, etc.)
- Full framework library (beyond basic structure)
- North star editor UI (use chat for now)
- Weekly/quarterly review UI (use chat for now)
- Push notifications
- Android
- Conflict resolution edge cases

### First Working Loop

1. User signs up (Supabase auth)
2. Starts 7-day trial
3. Connects Google Drive
4. Writes a capture
5. Memory updates automatically
6. Chats with AI (has context from capture)
7. Everything syncs to Drive
8. Next day: does check-in
9. After trial: subscribes via Stripe

---

## Build Order

| Phase | Focus |
|-------|-------|
| 1 | Shell, auth, Google Drive connected, one file writes/reads |
| 2 | Captures + Dexie + sync working |
| 3 | Chat with memory context |
| 4 | Checkins, learning loop, memory updates |
| 5 | Stripe integration, subscription flow |
| 6 | Polish, edge cases, dog-fooding |

### First Day Checklist

1. Scaffold TanStack Start project
2. Add Capacitor, init iOS
3. Tailwind + shadcn setup
4. Supabase project + auth
5. Dexie schema for captures, checkins, chats, memory
6. Run on simulator - make sure shell works

---

## Licensing

**Recommendation:** MIT License

- Maximum adoption and community contribution
- Simple and inviting
- Building primarily for personal use, open sourcing for transparency
- If someone commercializes it, they still need to do hosting, marketing, support

**Alternative:** AGPL if you want to prevent closed-source SaaS forks

---

## Open Questions / Future Considerations

1. Push notification strategy for iOS
2. Apple Sign In integration
3. App Store submission timing
4. Weekly/quarterly review dedicated UI
5. Full framework library with all exercises
6. Memory search/browse UI
7. Cost monitoring thresholds for AI calls
8. Multi-device simultaneous usage edge cases
9. Android timeline
